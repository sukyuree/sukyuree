MAIN 	START 	1000

STINIT1	LDA	#STACK_L
	STA	TOP_L
	STA	TOP_L_P

STINIT2	LDA	#STACK_R
	STA	TOP_R
	STA	TOP_R_P
	LDA	#0

LOOP	TD	STDIN
	JEQ	LOOP
	RD	STDIN
	COMP	ASEN
	JEQ	CHECK_N
	STCH	BUFFER,X
	TIX	#3
	JEQ	CHECK_N
	JLT	LOOP

CHECK_N	LDX	#1
	LDCH	BUFFER,X
	COMP	#0
	JGT	MK_N10
	JEQ	MK_N1

MK_N10	LDA	#0
	LDX	#1
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N_1
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	N_10
	ADD	N_1
	SUB	#1
	STA	NODE
	J	INPUT_N

MK_N1	LDA	#0
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N_1
	SUB	#1
	STA	NODE
	J	INPUT_N

INPUT_N	LDX	#0
	LDA	#0
	STA	BUFFER
	LDX	#1
	STCH	BUFFER,X
	LDX	#2
	STCH	BUFFER,X
	LDX	#3
	STCH	BUFFER,X
	LDX	#4
	STCH	BUFFER,X
	LDX	#0
	STA	N1
	STA	N2
	STA	N3
	STA	N4
	LDA	NODE
	COMP	COUNT
	JGT	KEEP_N
	JEQ	LOOPP
	JLT	LOOPP

KEEP_N	TD	STDIN
	JEQ	KEEP_N
	RD	STDIN
	COMP	ASEN
	JEQ	GO_N
	STCH	BUFFER,X
	TIX	#5
	JEQ	GO_N
	JLT	KEEP_N

GO_N	JSUB	CHE_NB1
	LDA	N1
	STA	@TOP_L
	JSUB	PUSH_L
	LDA	N2
	STA	@TOP_R
	JSUB	PUSH_R
	LDA	COUNT
	ADD	#1
	STA	COUNT	
	J	INPUT_N

CHE_NB1	LDA	#0
	LDX	#1
	LDCH	BUFFER,X
	COMP	SPACE
	JEQ	CHE_NB2
	J	CHE_NB3

CHE_NB2	LDA	#0
	LDX	#3
	LDCH	BUFFER,X
	COMP	#0
	JEQ	ONE_ONE
	J	ONE_TEN

CHE_NB3	LDA	#0
	LDX	#4
	LDCH	BUFFER,X
	COMP	#0
	JEQ	TEN_ONE
	JGT	TEN_TEN

ONE_ONE	LDA	#0
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N1
	LDX	#2
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N2
	RSUB

ONE_TEN	LDA	#0
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N1
	LDX	#3
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N4
	LDX	#2
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	N3
	ADD	N4
	STA	N2
	RSUB
	
TEN_ONE	LDA	#0
	LDX	#1
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N2
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	N1
	ADD	N2
	STA	N1
	LDX	#3
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N2
	RSUB


TEN_TEN	LDA	#0
	LDX	#1
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N2
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	N1
	ADD	N2
	STA	N1
	LDX	#4
	LDCH	BUFFER,X
	SUB	MK_I
	STA	N4
	LDX	#3
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	N3
	ADD	N4
	STA	N2
	RSUB
	
LOOPP	LDA	#0
	LDX	#0
	STA	BUFFER
	LDX	#1
	STCH	BUFFER,X
	LDX	#2
	STCH	BUFFER,X
	LDX	#3
	STCH	BUFFER,X
	LDX	#4
	STCH	BUFFER,X
	LDX	#0
LOOP2	TD	STDIN
	JEQ	LOOP2
	RD	STDIN
	COMP	ASEN
	JEQ	CHECK_M
	STCH	BUFFER,X
	TIX	#3
	JEQ	CHECK_M
	JLT	LOOP2

CHECK_M	LDX	#1
	LDCH	BUFFER,X
	COMP	#0
	JGT	MK_M10
	JEQ	MK_M1

MK_M10	LDX	#1
	LDCH	BUFFER,X
	SUB	MK_I
	STA	M_1
	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	MUL	#10
	STA	M_10
	ADD	M_1
	STA	NUM_M
	LDA	#0
	STA	COUNT
	J	INPUT_M

MK_M1	LDX	#0
	LDCH	BUFFER,X
	SUB	MK_I
	STA	M_1
	STA	NUM_M
	LDA	#0
	STA	COUNT
	J	INPUT_M

INPUT_M	LDA	#0
	STA	BUFFER
	LDX	#1
	STCH	BUFFER,X
	LDX	#2
	STCH	BUFFER,X
	LDX	#3
	STCH	BUFFER,X
	LDX	#4
	STCH	BUFFER,X
	STA	N1
	STA	N2
	STA	N3
	STA	N4
	STA	WHILE
	STA	COUNT_1
	STA	COUNT_2
	LDX	#0
	LDA	NUM_M
	COMP	COUNT2
	JEQ	END
	JGT	KEEP_M

KEEP_M	TD	STDIN
	RD	STDIN
	COMP	ASEN
	JEQ	GO_M
	STCH	BUFFER,X
	TIX	#5
	JEQ	GO_M
	JLT	KEEP_M

GO_M	JSUB	CHE_NB1
	LDA	N1
	STA	N1_P
	LDA	N2
	STA	N2_P
	JSUB	STORE_L
	LDA	COUNT2
	ADD	#1
	STA	COUNT2
	J	INPUT_M

STORE_L	STL	CURRENT	
COMPARE	LDA	#0
	STA	COUNT_1
	STA	COUNT_2
	LDA	WHILE
	COMP	#1
	JEQ	BACK
	JSUB	FIND_1P
	LDA	N1_P
	COMP	N2
	JEQ	PRINT_P
	JSUB	FIND_2P
	LDA	N2_P
	COMP	N1
	JEQ	PRINT_P
	COMP	N1_P
	JEQ	PRINT_P
	LDA	N1_P
	STA	N1
	LDA	N2_P
	STA	N2
	J	COMPARE

BACK	LDL	CURRENT
	RSUB

FIND_1P	LDA	COUNT_1
	COMP	NODE
	JLT	SEARCH1
	JEQ	BACK_1
BACK_1	RSUB
SEARCH1	MUL	#3
	ADD	TOP_R_P
	STA	TEMP_R
	LDA	@TEMP_R
	COMP	N1
	JEQ	STORE1
	LDA	COUNT_1
	ADD	#1
	STA	COUNT_1
	J	FIND_1P
STORE1	LDA	COUNT_1
	MUL	#3
	ADD	TOP_L_P
	STA	TEMP_L
	LDA	@TEMP_L
	STA	N1_P
	LDA	COUNT_1
	ADD	#1
	STA	COUNT_1
	RSUB

FIND_2P	LDA	COUNT_2
	COMP	NODE
	JLT	SEARCH2
	JEQ	BACK_2
BACK_2	RSUB
SEARCH2	MUL	#3
	ADD	TOP_R_P
	STA	TEMP_R
	LDA	@TEMP_R
	COMP	N2
	JEQ	STORE2
	LDA	COUNT_2
	ADD	#1
	STA	COUNT_2
	J	FIND_2P
STORE2	LDA	COUNT_2
	MUL	#3
	ADD	TOP_L_P
	STA	TEMP_L
	LDA	@TEMP_L
	STA	N2_P
	LDA	COUNT_2
	ADD	#1
	STA	COUNT_2
	RSUB

PRINT_P	STA	PARENT
	LDA	#1
	STA	WHILE
	J	PRINT_1


	
PRINT_1	LDA	PARENT
	COMP	ASEN
	JEQ	PRINT_2
	JGT	PRINT_2
	ADD	MK_I
	WD	STDOUT
	LDA	ASEN
	WD	STDOUT
	LDL	CURRENT
	RSUB

PRINT_2	STA	TEMP
	DIV	ASEN
	ADD	MK_I
	WD	STDOUT
	MUL	ASEN
	STA	TEN
	LDA	TEMP
	SUB	TEN
	STA	ONE
	ADD	MK_I
	WD	STDOUT
	LDA	ASEN
	WD	STDOUT
	LDL	CURRENT
	RSUB	

END	J	END

	

PUSH_L	LDA	TOP_L
	ADD	#3
	STA	TOP_L
	RSUB

POP_L	LDA	TOP_L
	SUB	#3
	STA	TOP_L
	RSUB

PUSH_R	LDA	TOP_R
	ADD	#3
	STA	TOP_R
	RSUB

POP_R	LDA	TOP_R
	SUB	#3
	STA	TOP_R
	RSUB



STACK_L	RESW	19
STACK_R	RESW	19

MK_I	WORD	48

ASEN	WORD	10
SPACE	WORD	32



STDIN	BYTE	0
STDOUT	BYTE	1

BUFFER	RESB	5

COUNT_1	RESW	1
COUNT_2	RESW	1
NUM_M	RESW	1
COUNT	RESW	1
COUNT2	RESW	1
NODE	RESW	1
SPOT	RESW	1

WHILE	RESW	1
N1_P	RESW	1
N2_P	RESW	1
COMP_C	RESW	1
TOP_L_P	RESW	1
TOP_R_P	RESW	1
LESS	RESW	1
LARGE	RESW	1
TOP_L	RESW	1
TOP_R	RESW	1
M_1	RESW	1
M_10	RESW	1
M1	RESW	1
M2	RESW	1
M3	RESW	1
M4	RESW	1
N_1	RESW	1
N_10	RESW	1
N1	RESW	1
N2	RESW	1
N3	RESW	1
N4	RESW	1
T_1	RESW	1
T_10	RESW	1
TEMP	RESW	1
ONE	RESW	1
TEN	RESW	1
PARENT	RESW	1
TEMP_L	RESW	1
TEMP_R	RESW	1
CURRENT	RESW	1
